generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  // Note: url is omitted here for Prisma 7 compatibility. 
  // It must be defined in your prisma.config.ts.
}

enum Role {
  ARTISAN
  CUSTOMER
  ADMIN
  PENDING
}

enum AuctionStatus {
  ACTIVE
  SOLD
  UNSOLD
}

model User {
  id           String        @id @default(cuid())
  clerkId      String        @unique
  email        String        @unique
  name         String?
  role         Role          @default(PENDING)
  languages    String[]
  preferences  Json?
  profile      Profile?
  products     Product[]
  orders       Order[]
  bids         Bid[]
  forumPosts   ForumPost[]
  chatHistory  ChatHistory[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model Profile {
  id                String  @id @default(cuid())
  user              User    @relation(fields: [userId], references: [id])
  userId            String  @unique
  businessName      String?
  craftType         String? 
  bio               String?
  location          String?
  state             String? 
  yearsOfExperience Int?    
}

model Product {
  id          String       @id @default(cuid())
  title       String
  description String
  price       Float
  category    String
  materials   String[]
  images      String[]
  stock       Int          @default(1)
  tags        String[]
  views       Int          @default(0)
  salesCount  Int          @default(0)
  artisan     User         @relation(fields: [artisanId], references: [id])
  artisanId   String
  auction     AuctionItem?
  orderItems  OrderItem[]  
  createdAt   DateTime      @default(now())
}

model Order {
  id         String      @id @default(cuid())
  total      Float
  status     String      @default("PENDING")
  customer   User        @relation(fields: [customerId], references: [id])
  customerId String
  items      OrderItem[] 
  createdAt  DateTime    @default(now())
}

model OrderItem {
  id        String  @id @default(cuid())
  order     Order   @relation(fields: [orderId], references: [id])
  orderId   String
  product   Product @relation(fields: [productId], references: [id])
  productId String
  quantity  Int
  price     Float   
}

model AuctionItem {
  id           String        @id @default(cuid())
  product      Product       @relation(fields: [productId], references: [id])
  productId    String        @unique
  basePrice    Float
  reservePrice Float?
  currentBid   Float         @default(0)
  startTime    DateTime      @default(now())
  endTime      DateTime
  status       AuctionStatus @default(ACTIVE)
  bids         Bid[]
}

model Bid {
  id        String      @id @default(cuid())
  amount    Float
  timestamp DateTime    @default(now())
  user      User        @relation(fields: [userId], references: [id])
  userId    String
  auction   AuctionItem @relation(fields: [auctionId], references: [id])
  auctionId String
}

model ChatHistory {
  id       String @id @default(cuid())
  messages Json
  user     User   @relation(fields: [userId], references: [id])
  userId   String
}

model ForumPost {
  id      String   @id @default(cuid())
  content String
  tags    String[]
  flagged Boolean  @default(false)
  user    User     @relation(fields: [userId], references: [id])
  userId  String
}

model Story {
  id        String   @id @default(cuid())
  title     String
  content   String
  heroImage String?
  artisanId String
  createdAt DateTime @default(now())
}